#!/usr/bin/env pwsh
<#
.SYNOPSIS
    Git pre-commit hook to validate project constraints

.DESCRIPTION
    This hook runs before each commit to ensure .NET 8.0 constraints are met.

    To install:
    1. Copy this file to .git/hooks/pre-commit
    2. Make it executable: chmod +x .git/hooks/pre-commit (on Unix)

    To bypass (use sparingly):
    git commit --no-verify
#>

Write-Host "`nüîç Running pre-commit constraint validation..." -ForegroundColor Cyan

# Run the constraint validation script
$scriptPath = Join-Path $PSScriptRoot "../../verify-constraints.ps1"

if (Test-Path $scriptPath) {
    & $scriptPath
    $exitCode = $LASTEXITCODE

    if ($exitCode -ne 0) {
        Write-Host "`n‚ùå Commit blocked due to constraint violations" -ForegroundColor Red
        Write-Host "Fix the issues above or use 'git commit --no-verify' to bypass (not recommended)" -ForegroundColor Yellow
        exit 1
    }
}
else {
    Write-Warning "Constraint validation script not found at $scriptPath"
    Write-Host "Proceeding with commit..." -ForegroundColor Yellow
}

Write-Host "‚úÖ Pre-commit checks passed`n" -ForegroundColor Green
exit 0
